{"componentChunkName":"component---node-modules-pauliescanlon-gatsby-theme-terminal-src-layouts-source-layout-js","path":"/posts/2020/04/IntersectionObserver/","result":{"data":{"mdx":{"id":"d53bfa90-fd36-5c44-be34-bb2c71e9f115","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Intersection Observer\",\n  \"tags\": [\"React\", \"JavaScript\"],\n  \"date\": \"2020-04-15T00:00:00.000Z\",\n  \"dateModified\": \"2020-04-16T00:00:00.000Z\",\n  \"author\": \"Paul Scanlon\",\n  \"featuredImageUrl\": \"https://res.cloudinary.com/www-paulie-dev/image/upload/v1595915575/paulie.dev/2020/04/intersection-observer_bplmy6.jpg\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar Divider = makeShortcode(\"Divider\");\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Recently at work i was asked to create a scroll-jacking sticky nav and after trying out numerous open source projects\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/joshwnj/react-visibility-sensor\"\n  }), \"react-visibility-sensor\"), \",\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/n8tb1t/use-scroll-position\"\n  }), \"use-scroll-position\"), \" and\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/bitworking/react-scrollmagic\"\n  }), \"react-scrollmagic\"), \" to name a few i settled on rolling my own using\\nReact, vanilla JavaScript and the\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://developer.mozilla.org/en-us/docs/web/api/intersection_observer_api\"\n  }), \"Intersection Observer API\")), mdx(\"p\", null, \"In this post i'll show you how to create a reusable Intersection Observer component with React.\"), mdx(\"p\", null, \"The IntersectionObserver component will manage a few things. These are;\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Creating a new \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"IntersectionObserver\"), \" instance\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Creating a DOM ref\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Rendering it's children.\")), mdx(\"p\", null, \"A first pass at this component looks like this \\uD83D\\uDC47\"), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"// ReactObserver.js\\nimport React, { useRef, useEffect } from 'react'\\n\\nconst ReactObserver = ({ children }) => {\\n  const ref = useRef(null)\\n\\n  useEffect(() => {\\n    const observer = new IntersectionObserver(\\n      ([entry]) => {\\n        if (entry.isIntersecting) {\\n          console.log('ReactObserver is more that 0.2 percent visible')\\n        }\\n      },\\n      {\\n        root: null,\\n        rootMargin: '0px',\\n        threshold: 0.2,\\n      },\\n    )\\n    if (ref && ref.current) {\\n      observer.observe(ref.current)\\n    }\\n  }, [])\\n\\n  return <div ref={ref}>{children}</div>\\n}\\n\\nexport default ReactObserver\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"And to use it you can do something like this \\uD83D\\uDC47\"), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"// SomeComponent.js\\nimport ReactObserver from \\\"./RectObserver\\\"\\n\\n...\\n<div style={{ height: \\\"100vh\\\", background: \\\"red\\\" }} />\\n<ReactObserver>\\n    <h1>Oh hai</h1>\\n    <p>I'm a child of the React Observer</p>\\n    <img\\n        src=\\\"http://place-puppy.com/2000x2000\\\"\\n        alt=\\\"puppy\\\"\\n        style={{ width: 300, height: 300 }}\\n    />\\n</ReactObserver>\\n...\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"This isn't going to do very much but if you've got this far you'll see a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"console.log()\"), \" when the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ReactObserver\"), \"\\ncomponent enters the viewport.\"), mdx(\"p\", null, \"You may have also noticed there's a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<div />\"), \" with a height of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"100vh\"), \" which will push the image out of the viewport. At\\nthe moment the browser is still going to try and download the image even though it can't be seen by the user... this\\nisn't great \\u261D\\uFE0F\"), mdx(\"p\", null, \"Let's correct that!\"), mdx(\"p\", null, \"For the second pass at this component we're going add a little bit of state to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ReactObserver\"), \" component using React\\nhooks and instead of just logging a message to the console we're going to change the state.\"), mdx(\"p\", null, \"This state change will allow us to return or \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"not\"), \" return the children.\"), mdx(\"p\", null, \"In practical terms this means that the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<img />\"), \" tag won't be in the DOM and the browser won't attempt to download it\\nuntil the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ReactObserver\"), \" component enters the viewport.\"), mdx(\"p\", null, \"When the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ReactObserver\"), \" component enters the viewport we can set the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"isChildVisible\"), \" state hook to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"true\"), \" which when\\ncombined with a ternary operator can be used to determine if we should render the children.\"), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"// ReactObserver.js\\nimport React, { useRef, useEffect, useState } from 'react'\\n\\nconst ReactObserver = ({ children }) => {\\n  const ref = useRef(null)\\n  const [isChildVisible, setIsChildVisible] = useState(false)\\n\\n  useEffect(() => {\\n    const observer = new IntersectionObserver(\\n      ([entry]) => {\\n        if (entry.isIntersecting) {\\n          setIsChildVisible(true)\\n        }\\n      },\\n      {\\n        root: null,\\n        rootMargin: '0px',\\n        threshold: 0.2,\\n      },\\n    )\\n    if (ref && ref.current) {\\n      observer.observe(ref.current)\\n    }\\n  }, [isChildVisible])\\n\\n  return <div ref={ref}>{isChildVisible ? children : null}</div>\\n}\\n\\nexport default ReactObserver\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"There are more methods besides \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"entry.isIntersecting\"), \" which i've found to be quite useful.\"), mdx(\"p\", null, \"For instance using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"entry.intersectionRatio\"), \" is useful for determining when the component enters and exits the\\nviewpoint, and by changing the threshold values and adding conditions you can determine when certain events are fired.\"), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"import React, { useRef, useEffect, useState } from 'react'\\n\\nconst ReactObserver = ({ children }) => {\\n  const ref = useRef(null)\\n  const [isChildVisible, setIsChildVisible] = useState(false)\\n\\n  useEffect(() => {\\n    const observer = new IntersectionObserver(\\n      ([entry]) => {\\n        if (entry.isIntersecting) {\\n          setIsChildVisible(true)\\n        }\\n        if (entry.intersectionRatio > 0) {\\n          console.log('ReactObserver has entered the viewpoint')\\n        }\\n        if (entry.intersectionRatio <= 0) {\\n          console.log('ReactObserver has exited the viewpoint')\\n        }\\n      },\\n      {\\n        root: null,\\n        rootMargin: '0px',\\n        threshold: [0, 1],\\n      },\\n    )\\n    if (ref && ref.current) {\\n      observer.observe(ref.current)\\n    }\\n  }, [isChildVisible])\\n\\n  return <div ref={ref}>{isChildVisible ? children : null}</div>\\n}\\n\\nexport default ReactObserver\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"To make your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ReactObserver\"), \" component even more reusable you might want to consider exposing some of the internal\\nconfiguration via \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"props\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"import React, { useRef, useEffect, useState } from 'react'\\nimport PropTypes from 'prop-types'\\n\\nconst ReactObserver = ({ children, threshold }) => {\\n  const ref = useRef(null)\\n  const [isChildVisible, setIsChildVisible] = useState(false)\\n\\n  useEffect(() => {\\n    const observer = new IntersectionObserver(\\n      ([entry]) => {\\n        if (entry.isIntersecting) {\\n          setIsChildVisible(true)\\n        }\\n        if (entry.intersectionRatio > 0) {\\n          console.log('ReactObserver has entered the viewpoint')\\n        }\\n        if (entry.intersectionRatio <= 0) {\\n          console.log('ReactObserver has exited the viewpoint')\\n        }\\n      },\\n      {\\n        root: null,\\n        rootMargin: '0px',\\n        threshold: threshold,\\n      },\\n    )\\n    if (ref && ref.current) {\\n      observer.observe(ref.current)\\n    }\\n  }, [isChildVisible, threshold])\\n\\n  return <div ref={ref}>{isChildVisible ? children : null}</div>\\n}\\n\\nReactObserver.propTypes = {\\n  /** The threshold values */\\n  threshold: PropTypes.oneOfType([PropTypes.number, PropTypes.arrayOf(PropTypes.number)]),\\n}\\n\\nexport default ReactObserver\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"And to use it you can do something like this \\uD83D\\uDC47\"), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"<ReactObserver threshold={0.5}>\\n  <h1>Oh hai</h1>\\n  <p>I'm a child of the React Observer</p>\\n  <img src=\\\"http://place-puppy.com/2000x2000\\\" alt=\\\"puppy\\\" style={{ width: 300, height: 300 }} />\\n</ReactObserver>\\n\")), mdx(\"p\", null, \"In the above example the threshold is set to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"0.5\"), \" which translates to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"IntersectionObserver\"), \" not firing until at\\nleast \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"0.5\"), \" of the component has entered the viewport\"), mdx(\"p\", null, \"There are way more scenarios when using an IntersectionObserver will be helpful in your project but i hope this at least\\nhelps you understand the basic concept.\"), mdx(\"p\", null, \"Happy observing \\uD83D\\uDE0A\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Recently at work i was asked to create a scroll-jacking sticky nav and after trying out numerous open source projects\n react-visibilityâ€¦","timeToRead":2,"wordCount":{"words":406},"slug":"2020/04/IntersectionObserver","frontmatter":{"title":"Intersection Observer","tags":["React","JavaScript"],"date":"2020-04-15T00:00:00.000Z","dateModified":"2020-04-16T00:00:00.000Z","author":"Paul Scanlon","status":null,"isPrivate":null,"url":null,"misc":null,"pinned":null,"featuredImage":null,"embeddedImages":null},"featuredImageUrl":{"url":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMFAf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHHz6sTxIn/xAAZEAACAwEAAAAAAAAAAAAAAAAAAgEDBBH/2gAIAQEAAQUCoyoLlrJyT2mx2GIdlP/EABYRAQEBAAAAAAAAAAAAAAAAAAABIf/aAAgBAwEBPwGMf//EABURAQEAAAAAAAAAAAAAAAAAAAAh/9oACAECAQE/AVf/xAAaEAEBAQEAAwAAAAAAAAAAAAABABEhAiJh/9oACAEBAAY/AhzJHGfUz5d8rJB5t//EABoQAAMBAQEBAAAAAAAAAAAAAAABIRFBMfH/2gAIAQEAAT8haTc0uujbyXJSOun0JKMhrk89DZtP/9oADAMBAAIAAwAAABDgz//EABYRAQEBAAAAAAAAAAAAAAAAAAEQEf/aAAgBAwEBPxDCR//EABYRAAMAAAAAAAAAAAAAAAAAAAEQIf/aAAgBAgEBPxAxP//EABwQAQEAAgMBAQAAAAAAAAAAAAERACExQaFRgf/aAAgBAQABPxBzyt0UkeNcPuPwbUGi+PXeX15JIgfKhXIEgYGgPzNU1PB3hi4IAQXgvWf/2Q=="},"images":{"fallback":{"src":"/static/f9bfb338604650dcce07bb8797d88511/59894/intersection-observer_bplmy6.jpg","srcSet":"/static/f9bfb338604650dcce07bb8797d88511/5de87/intersection-observer_bplmy6.jpg 750w,\n/static/f9bfb338604650dcce07bb8797d88511/a1c7d/intersection-observer_bplmy6.jpg 1080w,\n/static/f9bfb338604650dcce07bb8797d88511/3141f/intersection-observer_bplmy6.jpg 1366w,\n/static/f9bfb338604650dcce07bb8797d88511/59894/intersection-observer_bplmy6.jpg 1920w","sizes":"100vw"},"sources":[{"srcSet":"/static/f9bfb338604650dcce07bb8797d88511/5846e/intersection-observer_bplmy6.avif 750w,\n/static/f9bfb338604650dcce07bb8797d88511/92457/intersection-observer_bplmy6.avif 1080w,\n/static/f9bfb338604650dcce07bb8797d88511/64926/intersection-observer_bplmy6.avif 1366w,\n/static/f9bfb338604650dcce07bb8797d88511/0db38/intersection-observer_bplmy6.avif 1920w","type":"image/avif","sizes":"100vw"},{"srcSet":"/static/f9bfb338604650dcce07bb8797d88511/d02c5/intersection-observer_bplmy6.webp 750w,\n/static/f9bfb338604650dcce07bb8797d88511/a2563/intersection-observer_bplmy6.webp 1080w,\n/static/f9bfb338604650dcce07bb8797d88511/2933d/intersection-observer_bplmy6.webp 1366w,\n/static/f9bfb338604650dcce07bb8797d88511/9e479/intersection-observer_bplmy6.webp 1920w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5625}}}},"embeddedImageUrls":null,"fields":{"slug":"/posts/2020/04/IntersectionObserver/","owner":"source","parent":"posts"}}},"pageContext":{"id":"d53bfa90-fd36-5c44-be34-bb2c71e9f115","prev":{"frontmatter":{"title":"Svg Icon Systems","status":null},"fields":{"slug":"/posts/2020/04/svg-icon-systems/"}},"next":{"frontmatter":{"title":"100DaysOfGatsby - The Roundup","status":null},"fields":{"slug":"/posts/2020/04/100DaysOfGatsby-TheRoundup/"}},"parent":"posts"}},"staticQueryHashes":["1095393795","1469902088","2504239491","3642847879","571831435"]}
{"componentChunkName":"component---node-modules-pauliescanlon-gatsby-theme-terminal-src-layouts-source-layout-js","path":"/posts/2021/07/gatsby-create-schema-customization/","result":{"data":{"mdx":{"id":"507717ae-4642-5374-adb3-6356cd7cbc42","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Modify Gatsby's GraphQL data types using createSchemaCustomization\",\n  \"tags\": [\"React\", \"Gatsby\", \"JavaScript\", \"GraphQL\"],\n  \"date\": \"2021-07-02T00:00:00.000Z\",\n  \"author\": \"Paul Scanlon\",\n  \"featuredImageUrl\": \"https://res.cloudinary.com/www-paulie-dev/image/upload/v1625228217/paulie.dev/2021/07/gatsby-create-schema-customization_c88wzg.jpg\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar Divider = makeShortcode(\"Divider\");\nvar YouTube = makeShortcode(\"YouTube\");\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Hi friends, yesterday I published a little post about how to\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"/posts/2021/07/gatsby-source-nodes/\"\n  }), \"Add data to Gatsby's GraphQL layer using sourceNodes\"), \", this post will be expanding\\non the topic of data management but this time i'm going to hone in on how to modify GraphQL's inferred data types so\\nthat you can use the new upgraded \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.gatsbyjs.com/plugins/gatsby-plugin-image/\"\n  }), \"gatsby-plugin-image\"), \" with\\nremotely sourced images.\"), mdx(\"p\", null, \"If you'd prefer to jump ahead here's a demo repo:\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/PaulieScanlon/nasa-image-type\"\n  }), \"https://github.com/PaulieScanlon/nasa-image-type\")), mdx(\"p\", null, \"... and a live demo can be seen here: \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://nasaimagetype.gatsbyjs.io/\"\n  }), \"https://nasaimagetype.gatsbyjs.io/\")), mdx(\"h2\", null, \"The Problem\"), mdx(\"p\", null, \"The \\\"problem\\\" with remotely sourced images is that they are usually returned by API's as url's, E.g\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http://example.com/images/some-image.jpg\")), mdx(\"p\", null, \"When GraphQL see's this it correctly infers the data type as a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"String\"), \". However, in order for\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.gatsbyjs.com/plugins/gatsby-plugin-image/\"\n  }), \"gatsby-plugin-image\"), \" to process the image there are two\\nrequirements.\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"The GraphQL node must be of type \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"File\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"The image needs to have been downloaded and exist on your local filesystem\")), mdx(\"p\", null, \"In this post i'll explain how you can satisfy both of these requirements using a combination of\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.gatsbyjs.com/plugins/gatsby-source-filesystem/#createremotefilenode\"\n  }), \"createRemoteFileNode\"), \" from\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.gatsbyjs.com/plugins/gatsby-source-filesystem/\"\n  }), \"gatsby-source-filesystem\"), \" and\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.gatsbyjs.com/docs/reference/config-files/gatsby-node/#createSchemaCustomization\"\n  }), \"createSchemaCustomization\"), \"\\nwhich is utility function available in the\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.gatsbyjs.com/docs/reference/config-files/gatsby-node/\"\n  }), \"Gatsby Node API\")), mdx(\"p\", null, \"The code i'll be explaining below expands on yesterday's post:\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"/posts/2021/07/gatsby-source-nodes/\"\n  }), \"Add data to Gatsby's GraphQL layer using sourceNodes\"), \" so i'd advise you have a\\nread of that before diving in.\"), mdx(\"h2\", null, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#pre-flight-checks\"\n  }), \"Pre-Flight Checks\")), mdx(\"p\", null, \"You'll need to have all the following dependencies installed and configured in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-config.js\"), \" The docs can be found\\nhere: \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.gatsbyjs.com/plugins/gatsby-plugin-image/#installation\"\n  }), \"gatsby-plugin-image\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"yarn add gatsby-plugin-image gatsby-plugin-sharp gatsby-source-filesystem gatsby-transformer-sharp # npm install gatsby-plugin-image gatsby-plugin-sharp gatsby-source-filesystem gatsby-transformer-sharp --save\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"To use the approach I'll be using below you'll also need to have\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.gatsbyjs.com/plugins/gatsby-source-filesystem/?=gatsby-source\"\n  }), \"gatsby-source-filesystem\"), \" installed, but\\ndon't worry about adding it to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-config.js\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"yarn add gatsby-source-filesystem # npm install gatsby-source-filesystem --save\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"If you don't already have one, you'll need a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-config.js\"), \" at the root of you project:\"), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"...\\nsrc\\ngatsby-config.js\\npackage.json\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"And finally you'll need to add the following to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-config.js\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"// gatsby-config.js\\n\\nmodule.exports = {\\n  plugins: [\\n    `gatsby-plugin-image`,\\n    `gatsby-transformer-sharp`,\\n    {\\n      resolve: `gatsby-plugin-sharp`,\\n      options: {\\n        defaults: {\\n          quality: 70,\\n          formats: ['auto', 'webp', 'avif'],\\n          placeholder: 'blurred',\\n        },\\n      },\\n    },\\n  ],\\n}\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"I prefer to set the defaults for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-plugin-sharp\"), \" in my \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-config.js\"), \", this is optional, but i'd advise it.\"), mdx(\"h2\", null, \"1. Source The Image\"), mdx(\"p\", null, \"The following code can all be written in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-node.js\")), mdx(\"p\", null, \"I use \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.gatsbyjs.com/docs/reference/config-files/gatsby-node/#onCreateNode\"\n  }), \"onCreateNode\"), \" which is a Gatsby\\nfunction called each time a new node is created. By using an \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"if\"), \" condition I'm able to only call \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"createRemoteFileNode\"), \"\\nif the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"node.internal.type\"), \" equals \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"apod\"), \", which is the new node I created in yesterday's post.\"), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"// gatsby-node.js\\nconst { createRemoteFileNode } = require('gatsby-source-filesystem')\\n\\nexports.onCreateNode = async ({ node, actions: { createNode }, createNodeId, cache, store }) => {\\n  if (node.internal.type === 'apod') {\\n    node.image = await createRemoteFileNode({\\n      url: node.url,\\n      parentNodeId: node.id,\\n      createNode,\\n      createNodeId,\\n      cache,\\n      store,\\n    })\\n  }\\n}\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"Starting from the top I destructure \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"createRemoteFileNode\"), \" from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-source-filesystem\"), \", more on that in a moment.\"), mdx(\"p\", null, \"Next I define and export \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"onCreateNode\"), \". onCreateNode can be an \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"async\"), \" function and accepts a number of parameters\\nincluding but not limited to the following.\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"node\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"actions\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"createNodeId,\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"cache\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"store\")), mdx(\"h4\", null, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#node\"\n  }), \"node\")), mdx(\"p\", null, \"This is the new node type sourced from the NASA API and already exists in Gatsby's data layer\"), mdx(\"h4\", null, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#actions\"\n  }), \"actions\")), mdx(\"p\", null, \"Actions are the equivalent to actions bound with \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://redux.js.org/api/bindactioncreators/\"\n  }), \"bindActionCreators\"), \" in\\nRedux. \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"actions\"), \" contains a function called\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.gatsbyjs.com/docs/reference/config-files/actions/#createNode\"\n  }), \"createNode\"), \" and this is how you add data to\\nthe Redux state object / Gatsby's data layer\"), mdx(\"h4\", null, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#createNodeId\"\n  }), \"createNodeId\")), mdx(\"p\", null, \"This is effectively a helper function that aids in the creation of unique id's. Under the hood Gatsby are using\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.npmjs.com/package/uuid\"\n  }), \"uuid\"), \", you can of course use your preferred method but since uuid is already part\\nof the Gatsby bundle it makes sense to use it.\"), mdx(\"h4\", null, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#cache\"\n  }), \"cache\")), mdx(\"p\", null, \"Cache is the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".cache\"), \" directory Gatsby creates in/on your local filesystem\"), mdx(\"h4\", null, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#store\"\n  }), \"store\")), mdx(\"p\", null, \"This is Gatsby's Data layer / The Redux state object\"), mdx(\"p\", null, \"To the best of my knowledge all of the above are required. You might not see errors if you don't include \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cache\"), \" or\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"store\"), \" when creating a remote file node but I have experienced odd behavior if I failed to included them.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"The next bit deals with sourcing the image using the image url returned by the NASA API.\")), mdx(\"h4\", null, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#node-image\"\n  }), \"node.image\")), mdx(\"p\", null, \"I create a new object on the node and call it \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"image\"), \" which will be the response from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"createRemoteFileNode\"), \".\"), mdx(\"h3\", null, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#create-remote-file-node-params\"\n  }), \"createRemoteFileNode | params\")), mdx(\"p\", null, \"This function comes from \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.gatsbyjs.com/plugins/gatsby-source-filesystem/\"\n  }), \"gatsby-source-filesystem\"), \" and\\naccepts the following parameters\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"url\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"parentNodeId\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"createNode\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"createNodeId\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"cache\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"store\")), mdx(\"h4\", null, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#create-remmote-file-node-url\"\n  }), \"url\")), mdx(\"p\", null, \"The source url of the remote file\"), mdx(\"h4\", null, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#parent-node-id\"\n  }), \"parentNodeId\")), mdx(\"p\", null, \"The id of the parent node (i.e. the node to which the new remote File node will be linked to.\"), mdx(\"h4\", null, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#create-node\"\n  }), \"createNode\")), mdx(\"p\", null, \"The action used to create nodes, I covered this in more detail in yesterday's post\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://paulie.dev/posts/2021/07/gatsby-source-nodes/#actions-createNode\"\n  }), \"#actions-createNode\")), mdx(\"h4\", null, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#create-node-id\"\n  }), \"createNodeId\")), mdx(\"p\", null, \"A helper function for creating node ids, I covered this in more detail in yesterday's post\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"posts/2021/07/gatsby-source-nodes/#createNodeId\"\n  }), \"#createNodeId\")), mdx(\"h4\", null, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#cache\"\n  }), \"cache\")), mdx(\"p\", null, \"As above\"), mdx(\"h4\", null, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#store\"\n  }), \"store\")), mdx(\"p\", null, \"As Above\"), mdx(\"p\", null, \"With all of the above in place you should now be able to query the new \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"image\"), \" node in the GraphiQL explorer. Visit\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://localhost:8000/___graphql\"\n  }), \"http://localhost:8000/\", \"_\", \"_\", \"_\", \"graphql\"), \" to investigate.\"), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"{\\n  apod {\\n    url\\n    image {\\n      relativePath\\n    }\\n  }\\n}\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"Which should give you a response similar to the below\"), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"{\\n  \\\"data\\\": {\\n    \\\"apod\\\": {\\n      \\\"url\\\": \\\"https://apod.nasa.gov/apod/image/2107/AR2835_20210701_W2x1024.jpg\\\",\\n      \\\"image\\\": {\\n        \\\"relativePath\\\": \\\".cache/caches/default-site-plugin/bcd18c3c0f372d1ad0d180fa82cde702/AR2835_20210701_W2x1024.jpg\\\"\\n      }\\n    }\\n  },\\n}\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"You can see the new \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"image\"), \" node and by querying the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"relativePath\"), \" you can see that the file exists on disc in the\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".cache/caches\"), \" directory. Compare this to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"url\"), \" which has remained as it was, a remote url.\"), mdx(\"p\", null, \"This satisfies \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"one\"), \" of the two requirements I mentioned above, but GraphQL still thinks the data type is a\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"String\"), \"... but we know it's now actually a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"File\")), mdx(\"h2\", null, \"2. Modify the GraphQL type\"), mdx(\"p\", null, \"To see GraphQL's inferred types Gatsby have exposed an additional action called\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.gatsbyjs.com/docs/reference/config-files/actions/#printTypeDefinitions\"\n  }), \"printTypeDefinitions\"), \" which can be\\ncalled from Gatsby Node using this function:\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.gatsbyjs.com/docs/reference/config-files/gatsby-node#createSchemaCustomization\"\n  }), \"createSchemaCustomization\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"// gatsby-node.js\\n\\nexports.createSchemaCustomization = ({ actions: { createTypes, printTypeDefinitions } }) => {\\n  printTypeDefinitions({ path: './typeDefs.txt' })\\n}\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"If you've added the above to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-node.js\"), \" you can now run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby build\"), \" and you should see a file pop up in your\\nfilesystem called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"typeDefs.txt\"), \". Open it and scroll to the bottom, i've removed quite a lot from the below snippet for\\nbrevity, but the main thing to notice is that GraphQL has inferred that the new \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"image\"), \" node has a child node called\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"url\"), \" and is typed as a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"String\"), \" \\uD83D\\uDC4E\"), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"type apod implements Node @derivedTypes @dontInfer {\\n  ...\\n  title: String\\n  url: String\\n  image: apodImage\\n}\\n\\ntype apodImage @derivedTypes {\\n  ...\\n  url: String\\n}\\n\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"To correct this you can manually override GraphQL's type inference and provide your own type definitions. You can do\\nthis by using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"createTypes\"), \" from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"actions\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-diff\"\n  }), \"exports.createSchemaCustomization = ({\\n  actions: { createTypes, printTypeDefinitions }\\n}) => {\\n+  createTypes(`\\n+    type apod implements Node {\\n+      image: apodImage\\n+    }\\n+    type apodImage @dontInfer {\\n+      url: File @link(by: \\\"url\\\")\\n+    }\\n+  `);\\n\\n  printTypeDefinitions({ path: './typeDefs.txt' });\\n};\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"This looks a little peculiar if you're new to GraphQL and being honest I found this really difficult so here's my best\\nattempt to explain what's going on.\"), mdx(\"h4\", null, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#type-apod-image\"\n  }), \"type apodImage\")), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"apodImage\"), \" first needs to be set to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"@dontInfer\"), \". This is a way to tell GraphQL that I know best and i'll handle the\\ntypes so don't worry about inferring the data type.\"), mdx(\"h4\", null, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#apod-image-url\"\n  }), \"url\")), mdx(\"p\", null, \"Finally it's here where I tell GraphQL that the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"image.url\"), \" is of type \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"File\"), \" and I link it to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"url\"), \" defined by the\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"url\"), \" parameter from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"createRemoteFileNode\"), \" \\uD83E\\uDD75\"), mdx(\"p\", null, \"If you delete the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"typeDefs.txt\"), \" file from your local filesystem and run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby build\"), \" again and investigate the types\\nyou should now see the following.\"), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"\\ntype apod implements Node @dontInfer {\\n  ...\\n  title: String\\n  url: String\\n  image: apodImage\\n}\\n\\ntype apodImage {\\n  url: File @link(by: \\\"url\\\")\\n}\\n\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"And now GraphQL correctly understands that \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"image.url\"), \" is of type \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"File\"), \" -- Hooray! \\uD83C\\uDF89\"), mdx(\"p\", null, \"This now satisfies \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"both\"), \" of the above mentioned requirements!\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"If you see any weird looking errors in your terminal it might be best to run \", mdx(\"inlineCode\", {\n    parentName: \"em\"\n  }, \"gatsby clean\"), \" before running\\n\", mdx(\"inlineCode\", {\n    parentName: \"em\"\n  }, \"gatsby build\"), \" since we're messing with a few low level things\")), mdx(\"h2\", null, \"Using GatsbyImage\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-plugin-image\"), \" exports two components, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<StaticImage />\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<GatsbyImage />\"), \" I won't explain why we need to use\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<GatsbyImage />\"), \" but there's a good explanation in the docs:\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.gatsbyjs.com/plugins/gatsby-plugin-image/?=gatsby-plugin-image#using-the-gatsby-image-components\"\n  }), \"Using the Gatsby Image components\")), mdx(\"p\", null, \"With the type now set as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"File\"), \" you can now query the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"image.url\"), \" using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"childImageSharp.gatsbyImageData\"), \". The query\\ni've used in \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/PaulieScanlon/nasa-image-type/blob/main/src/pages/index.js\"\n  }), \"index.js\"), \" looks a little\\nsomething like this\"), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"{\\n  apod {\\n    id\\n    date\\n    explanation\\n    media_type\\n    service_version\\n    title\\n    url\\n    image {\\n      url {\\n        childImageSharp {\\n          gatsbyImageData\\n        }\\n      }\\n    }\\n  }\\n}\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"Which should return something similar to the below. You should be able to see the various image data objects,\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"placeholder\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"images\"), \", and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"sources\"), \". All of this can be passed on to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<GatsbyImage />\"), \" component.\"), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"{\\n  \\\"data\\\": {\\n    \\\"apod\\\": {\\n      \\\"id\\\": \\\"63a09eef-2a28-5632-94c6-50061b62a0bf\\\",\\n      \\\"date\\\": \\\"2021-07-02\\\",\\n      \\\"explanation\\\": \\\"Awash in a sea of incandescent plasma and anchored in strong magnetic fields, sunspots are planet-sized dark islands in the solar photosphere, the bright surface of the Sun. Found in solar active regions, sunspots look dark only because they are slightly cooler though, with temperatures of about 4,000 kelvins compared to 6,000 kelvins for the surrounding solar surface. These sunspots lie in active region AR2835. The largest active region now crossing the Sun, AR2835 is captured in this sharp telescopic close-up from July 1 in a field of view that spans about 150,000 kilometers or over ten Earth diameters. With powerful magnetic fields, solar active regions are often responsible for solar flares and coronal mass ejections, storms which affect space weather near planet Earth.\\\",\\n      \\\"media_type\\\": \\\"image\\\",\\n      \\\"service_version\\\": \\\"v1\\\",\\n      \\\"title\\\": \\\"AR2835: Islands in the Photosphere\\\",\\n      \\\"url\\\": \\\"https://apod.nasa.gov/apod/image/2107/AR2835_20210701_W2x1024.jpg\\\",\\n      \\\"image\\\": {\\n        \\\"url\\\": {\\n          \\\"childImageSharp\\\": {\\n            \\\"gatsbyImageData\\\": {\\n              \\\"layout\\\": \\\"constrained\\\",\\n              \\\"placeholder\\\": {\\n                \\\"fallback\\\": \\\"data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAECAwQF/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAEEBv/aAAwDAQACEAMQAAAB6lTeeukZwf8A/8QAGRAAAgMBAAAAAAAAAAAAAAAAAQIAAxAh/9oACAEBAAEFAhGuRbIGwt3/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwFH/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8BR//EABkQAAIDAQAAAAAAAAAAAAAAAAEQABExA//aAAgBAQAGPwLIOZ0u6X//xAAbEAADAAIDAAAAAAAAAAAAAAAAAREhUTFBgf/aAAgBAQABPyGF6iKAdY+RuhtN4LsbR//aAAwDAQACAAMAAAAQ+x//xAAWEQADAAAAAAAAAAAAAAAAAAAQESH/2gAIAQMBAT8QVD//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREx/9oACAECAQE/EFFqKP/EABwQAAMAAgMBAAAAAAAAAAAAAAABETFRIUFh0f/aAAgBAQABPxBkpNlZF374QMUmWzJIaX0LDw6ciSJh7P/Z\\\"\\n              },\\n              \\\"images\\\": {\\n                \\\"fallback\\\": {\\n                  \\\"src\\\": \\\"/static/8574311e0c9d3b7520b2714c8baa995e/862d2/AR2835_20210701_W2x1024.jpg\\\",\\n                  \\\"srcSet\\\": \\\"/static/8574311e0c9d3b7520b2714c8baa995e/ac769/AR2835_20210701_W2x1024.jpg 256w,\\\\n/static/8574311e0c9d3b7520b2714c8baa995e/0e233/AR2835_20210701_W2x1024.jpg 512w,\\\\n/static/8574311e0c9d3b7520b2714c8baa995e/862d2/AR2835_20210701_W2x1024.jpg 1024w\\\",\\n                  \\\"sizes\\\": \\\"(min-width: 1024px) 1024px, 100vw\\\"\\n                },\\n                \\\"sources\\\": [\\n                  {\\n                    \\\"srcSet\\\": \\\"/static/8574311e0c9d3b7520b2714c8baa995e/c4e41/AR2835_20210701_W2x1024.avif 256w,\\\\n/static/8574311e0c9d3b7520b2714c8baa995e/542bf/AR2835_20210701_W2x1024.avif 512w,\\\\n/static/8574311e0c9d3b7520b2714c8baa995e/59a35/AR2835_20210701_W2x1024.avif 1024w\\\",\\n                    \\\"type\\\": \\\"image/avif\\\",\\n                    \\\"sizes\\\": \\\"(min-width: 1024px) 1024px, 100vw\\\"\\n                  },\\n                  {\\n                    \\\"srcSet\\\": \\\"/static/8574311e0c9d3b7520b2714c8baa995e/053d8/AR2835_20210701_W2x1024.webp 256w,\\\\n/static/8574311e0c9d3b7520b2714c8baa995e/93623/AR2835_20210701_W2x1024.webp 512w,\\\\n/static/8574311e0c9d3b7520b2714c8baa995e/41185/AR2835_20210701_W2x1024.webp 1024w\\\",\\n                    \\\"type\\\": \\\"image/webp\\\",\\n                    \\\"sizes\\\": \\\"(min-width: 1024px) 1024px, 100vw\\\"\\n                  }\\n                ]\\n              },\\n              \\\"width\\\": 1024,\\n              \\\"height\\\": 683\\n            }\\n          }\\n        }\\n      }\\n    }\\n  },\\n}\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"h2\", null, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#jsx\"\n  }), \"Jsx\")), mdx(\"p\", null, \"To return the above image data you can use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<GatsbyImage />\"), \" with the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"getImage\"), \" helper to pass the data on to\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<GatsbyImage />\"), \" via the\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"image\"), \" prop\"), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"import React from 'react'\\nimport { useStaticQuery, graphql } from 'gatsby'\\nimport { GatsbyImage, getImage } from 'gatsby-plugin-image'\\n\\nconst IndexPage = () => {\\n  const {\\n    apod: { id, date, explanation, media_type, service_version, title, image },\\n  } = useStaticQuery(graphql`\\n    query {\\n      apod {\\n        id\\n        date\\n        explanation\\n        media_type\\n        service_version\\n        title\\n        image {\\n          url {\\n            childImageSharp {\\n              gatsbyImageData\\n            }\\n          }\\n        }\\n      }\\n    }\\n  `)\\n\\n  return (\\n    <main>\\n      <p>{date}</p>\\n      <h1>{title}</h1>\\n      <p>{explanation}</p>\\n      <GatsbyImage alt={title} image={getImage(image.url)} /> // oh hai!\\n      <p>{`id: ${id}`}</p>\\n      <p>{`media_type: ${media_type}`}</p>\\n      <p>{`service_version: ${service_version}`}</p>\\n    </main>\\n  )\\n}\\n\\nexport default IndexPage\\n\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"... and there you have it, modifying GraphQL's data types for remotely sourced images! I've used this approach many\\ntimes in various projects and covered it quite conclusively with \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://twitter.com/raae\"\n  }), \"Benedicte Raae\"), \" on our pokey\\ninternet show\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.youtube.com/playlist?list=PL9W-8hhRoLoN7axEFJQ17rJvk2KTiM2GP\"\n  }), \"Gatsby Deep Dives with Queen Raae and the Nattermobs Pirates\")), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(YouTube, {\n    youTubeId: \"TfV9qGfNPJI\",\n    mdxType: \"YouTube\"\n  }), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"If you're looking for a similar solution when working with remote images in Markdown or MDX I wrote a post that can be\\nfound on the Gatsby blog:\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.gatsbyjs.com/blog/mdx-embedded-gatsby-image/\"\n  }), \"MDX Embedded Images with the All-New Gatsby Image Plugin\")));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Hi friends, yesterday I published a little post about how to\n Add data to Gatsby's GraphQL layer using sourceNodes , this post will be…","timeToRead":5,"wordCount":{"words":1216},"slug":"2021/07/gatsby-create-schema-customization","frontmatter":{"title":"Modify Gatsby's GraphQL data types using createSchemaCustomization","tags":["React","Gatsby","JavaScript","GraphQL"],"date":"2021-07-02T00:00:00.000Z","dateModified":null,"author":"Paul Scanlon","status":null,"isPrivate":null,"url":null,"misc":null,"pinned":null,"featuredImage":null,"embeddedImages":null},"featuredImageUrl":{"url":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFBv/EABUBAQEAAAAAAAAAAAAAAAAAAAQC/9oADAMBAAIQAxAAAAHN0EabCNE8lH//xAAbEAACAgMBAAAAAAAAAAAAAAACAwABBBExEv/aAAgBAQABBQIVeqxkDbCQuJ7yEV7/AP/EABgRAAIDAAAAAAAAAAAAAAAAAAIDEBES/9oACAEDAQE/ASZkqj//xAAXEQADAQAAAAAAAAAAAAAAAAAAARES/9oACAECAQE/AZUZP//EAB0QAAEEAgMAAAAAAAAAAAAAAAABAiExEBESYYH/2gAIAQEABj8CRUd4adJXHrEFn//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExQVH/2gAIAQEAAT8hAQt78TAlC6PY9F0Oo0E6HDH7U//aAAwDAQACAAMAAAAQ1x//xAAWEQEBAQAAAAAAAAAAAAAAAAABACH/2gAIAQMBAT8QQUQjt//EABgRAAIDAAAAAAAAAAAAAAAAAAABESFR/9oACAECAQE/EFYJaf/EABsQAQADAQADAAAAAAAAAAAAAAEAESExcYGR/9oACAEBAAE/EGqV4N+bUswCaPTSB8dilprCIcWmP3QRuqa6s//Z"},"images":{"fallback":{"src":"/static/90cfdad4294f9f6c81a4072f583bd9fd/ccd19/gatsby-create-schema-customization_c88wzg.jpg","srcSet":"/static/90cfdad4294f9f6c81a4072f583bd9fd/5de87/gatsby-create-schema-customization_c88wzg.jpg 750w,\n/static/90cfdad4294f9f6c81a4072f583bd9fd/ccd19/gatsby-create-schema-customization_c88wzg.jpg 1024w","sizes":"100vw"},"sources":[{"srcSet":"/static/90cfdad4294f9f6c81a4072f583bd9fd/5846e/gatsby-create-schema-customization_c88wzg.avif 750w,\n/static/90cfdad4294f9f6c81a4072f583bd9fd/47b7d/gatsby-create-schema-customization_c88wzg.avif 1024w","type":"image/avif","sizes":"100vw"},{"srcSet":"/static/90cfdad4294f9f6c81a4072f583bd9fd/d02c5/gatsby-create-schema-customization_c88wzg.webp 750w,\n/static/90cfdad4294f9f6c81a4072f583bd9fd/d819f/gatsby-create-schema-customization_c88wzg.webp 1024w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5625}}}},"embeddedImageUrls":null,"fields":{"slug":"/posts/2021/07/gatsby-create-schema-customization/","owner":"source","parent":"posts"}}},"pageContext":{"id":"507717ae-4642-5374-adb3-6356cd7cbc42","prev":{"frontmatter":{"title":"","status":null},"fields":{"slug":"/writing/"}},"next":{"frontmatter":{"title":"Add data to Gatsby's GraphQL layer using sourceNodes","status":null},"fields":{"slug":"/posts/2021/07/gatsby-source-nodes/"}},"parent":"posts"}},"staticQueryHashes":["1095393795","1469902088","2504239491","3642847879","571831435"]}